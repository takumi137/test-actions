name: One-shot Fargate Runner Flow

on:
  push:

jobs:
  control-runner:
    runs-on: ubuntu-latest  # GitHub-hosted runner ã§å‹•ä½œï¼ˆLambdaå‘¼ã³å‡ºã—ç”¨ï¼‰

    steps:
      - name: ğŸ”¼ èµ·å‹•ï¼šFargate Runner
        run: |
          curl -X POST https://YOUR_API_ID.execute-api.ap-northeast-1.amazonaws.com/prod/webhook \
            -H "Content-Type: application/json" \
            -d '{"action":"start","runner_name":"fargate-runner"}'

  job-on-fargate:
    needs: control-runner
    runs-on: [self-hosted, fargate]
    steps:
      - name: âœ… å®Ÿã‚¸ãƒ§ãƒ–ï¼ˆFargateä¸Šï¼‰
        run: echo "Running on Fargate runner"

  cleanup-runner:
    needs: job-on-fargate
    runs-on: ubuntu-latest
    if: always()  # æˆå¦ã«é–¢ã‚ã‚‰ãšå®Ÿè¡Œ
    steps:
      - name: ğŸ”½ çµ‚äº†ï¼šFargate Runner
        run: |
          curl -X POST https://YOUR_API_ID.execute-api.ap-northeast-1.amazonaws.com/prod/webhook \
            -H "Content-Type: application/json" \
            -d '{"action":"stop","runner_name":"fargate-runner"}'
